#!/bin/sh

# PATH modification needed for http_post and oauth_sign
export PATH=$PATH:/usr/local/bin

toplevel_path=`git rev-parse --show-toplevel`
toplevel_dir=`basename "$toplevel_path"`

subject=`git log --pretty=format:%s -n1`
tweet='[fman commit] '$subject

# truncate tweets that are longer than 140 characters
if [ ${#tweet} -gt 140 ]
    then
        tweet_trunc=$(echo $tweet | cut -c1-137)
        tweet=${tweet_trunc}...
fi

consumer_key="SXq4zKwK8Spg1c1Jl7f2Kcl2K"
consumer_secret="tcHPAO4gWg9OhzuWmi4IZbwm457Tz4QKQ8sq0eOrKyYnCEz6zq"
access_token="33020603-XhpVgvfde65x6K5CqtuZwmr8YrWRyYxOq546a4frF"
access_secret="xMtDluMPbue5zLDFjdjiGMFxltVJjQI9bOG7hQOPVYJZS"

url="https://api.twitter.com/1.1/statuses/update.json"

http_post -h Authorization "$(oauth_sign \
$consumer_key $consumer_secret \
$access_token $access_secret \
POST "$url" status="$tweet")" \
     "$url" status="$tweet"